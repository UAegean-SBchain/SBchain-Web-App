<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="#{personal.info.title}">Getting Started: Serving Web Content</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../static/css/main.css" th:href="@{/css/main.css}"/>
</head>
<body>
    <div th:replace="fragments/header"></div>
    <div class="container">
    <!-- <form method="get" action="#" th:action="@{/multi/personalInfo/save}" th:object="${ssiInformation}" id="infoForm"> -->
    <div th:replace="fragments/navigation"></div>    
    <h4 th:text="#{personal.info.title}" class="formTitle">Personal Info</h4>
            <hr class="divider--light">
        <div class="row__container"> 
            <div class="row doublecol__row">
<!--                <div class="inputContainer inputContainer--big">
                    <label th:text="#{ssn}" class="label input__label"> AMKA </label>
                    <input type="text" class="input personalInfo__input input--big" th:value="${ssiInfo != null}? ${ssiInfo[taxisAmka]} : ''" />
                </div>-->
                <div class="inputContainer inputContainer--big">
                    <label th:text="#{afm}" class="label input__label"> AFM </label>
                    <input id="AFM" type="text" class="input personalInfo__input input--big" th:value="${ssiInfo != null}? ${ssiInfo[taxisAfm]} : ''" readonly/>
                </div>
            </div>
            <div class="row doublecol__row">
                <div class="inputContainer inputContainer--big">
                    <label th:text="#{last.name}" class="label input__label"> Last Name </label>
                    <input type="text" class="input personalInfo__input input--big" th:value="${ssiInfo != null}? ${ssiInfo[taxisFamilyName]} : ''" readonly/>
                </div>
                <div class="inputContainer inputContainer--big">
                    <label th:text="#{first.name}" class="label input__label"> Name </label>
                    <input type="text" class="input personalInfo__input input--big" th:value="${ssiInfo != null}? ${ssiInfo[taxisFirstName]} : ''" readonly/>
                </div>
            </div>
            <div class="row doublecol__row">
                <div class="inputContainer inputContainer--big">
                    <label th:text="#{father.name}" class="label input__label"> Name of Father </label>
                    <input type="text" class="input personalInfo__input input--big" th:value="${ssiInfo != null}? ${ssiInfo[taxisFathersName]} : ''" readonly/>
                </div>
                <div class="inputContainer inputContainer--big">
                    <label th:text="#{mother.name}" class="label input__label"> Name of Mother </label>
                    <input type="text" class="input personalInfo__input input--big" th:value="${ssiInfo != null}? ${ssiInfo[taxisMothersName]} : ''" readonly/>
                </div>
            </div>
<!--            <div class="row doublecol__row">
                <div class="inputContainer inputContainer--big">
                    <label th:text="#{last.name.latin}" class="label input__label"> Last Name (Latin)</label>
                    <input type="text" class="input personalInfo__input input--big" th:value="${ssiInfo != null}? ${ssiInfo[taxisFamilyNameLatin]} : ''" readonly/>
                </div>
                <div class="inputContainer inputContainer--big">
                    <label th:text="#{first.name.latin}" class="label input__label"> First Name (Latin) </label>
                    <input type="text" class="input personalInfo__input input--big" th:value="${ssiInfo != null}? ${ssiInfo[taxisFirstNameLatin]} : ''" readonly/>
                </div>
            </div>-->
<!--            <div class="row doublecol__row">
                <div class="inputContainer inputContainer--big">
                    <label th:text="#{father.name.latin}" class="label input__label"> Name of Father(Latin) </label>
                    <input type="text" class="input personalInfo__input input--big" th:value="${ssiInfo != null}? ${ssiInfo[taxisFathersNameLatin]} : ''" readonly/>
                </div>
                <div class="inputContainer inputContainer--big">
                    <label th:text="#{mother.name.latin}" class="label input__label"> Name of Mother(Latin) </label>
                    <input type="text" class="input personalInfo__input input--big" th:value="${ssiInfo != null}? ${ssiInfo[taxisMothersNameLatin]} : ''" readonly/>
                </div>
            </div>-->
            <div class="row doublecol__row">
                <div class="inputContainer inputContainer--big">
                    <label th:text="#{date.of.birth}" class="label input__label"> Date of Birth </label>
                    <div class="inputContainerInfo">
                        <input type="text" class="input demographicInfo__input input--big input--date" th:value="${ssiInfo != null}? ${ssiInfo[taxisDateOfBirth]}" readonly/>
                    <div class="infoButton__wrapper">
                            <div class="infoButton input__info" th:text="i" id="resInfoButton">i</div>
                        </div>
                    </div>
                    <div class="infoTextBox" style="display:none;">
                        <div class="inftoTextContainer" th:text="#{personal.info.info.text}">
                        </div>
                    </div>
                </div>
                <div class="inputContainer inputContainer--big">
<!--                    <label th:text="#{gender}" class="label checkBox__label label--right"> Gender </label>
                    <div class="inputContainerCheckbox inputContainerInfo">
                        <input type="text" id="genderMain" th:value="${ssiInfo != null}? ${ssiInfo[taxisGender]}" readonly hidden="true">
                        <div class="checkboxContainer gender__checkboxContainer " id="maleBoxContainer">
                            <input type="checkbox" id="male" class="checkBox gender__checkBox maleBox" th:value="${false}" disabled>
                            <label th:text="#{male}" class="label checkBox__label label--right"> Male </label>
                        </div>  
                        <div class="checkboxContainer gender__checkboxContainer" id="femaleBoxContainer">
                            <input type="checkbox" id="female" class="checkBox gender__checkBox female" th:value="${false}" disabled>
                            <label th:text="#{female}" class="label checkBox__label label--right"> Female </label>
                        </div>
                        <div class="infoButton__wrapper">
                            <div class="infoButton input__info" th:text="i" >i</div>
                        </div>
                    </div>-->
                    <div class="infoTextBox" style="display:none;">
                        <div class="inftoTextContainer" th:text="#{personal.info.info.text}">
                        </div>
                    </div>
                </div>
            </div>
<!--            <div class="row doublecol__row">
                <div class="inputContainer inputContainer--big">
                    <label th:text="#{nationality}" class="label input__label"> Nationality </label>
                    <div class="inputContainerInfo">
                        <input type="text" class="input demographicInfo__input input--big" th:value="${ssiInfo != null}? ${ssiInfo[nationality]}" readonly/>
                        <div class="infoButton__wrapper">
                            <div class="infoButton input__info" th:text="i" >i</div>
                        </div>
                    </div>
                    <div class="infoTextBox" style="display:none;">
                        <div class="inftoTextContainer" th:text="#{personal.info.info.text}">
                        </div>
                    </div>
                </div>
                <div class="inputContainer inputContainer--big">
                    <label th:text="#{marital.status}" class="label input__label"> Marital Status </label>
                    <input type="text" class="input personalInfo__input input--big"  th:value="${ssiInfo != null}? ${ssiInfo[maritalStatus]}" readonly>
                </div>
            </div>-->
<!--            <div class="row doublecol__row">-->
<!--                <div class="inputContainer inputContainer&#45;&#45;big">-->
<!--                    <label th:text="#{disability.status}" class="label input__label"> Disability Status</label>-->
<!--                    <input type="text" class="input demographicInfo__input input&#45;&#45;big" th:value="${ssiInfo != null}? ${ssiInfo[disabilityStatus]}" readonly/>-->
<!--                </div>-->
<!--                <div class="inputContainer inputContainer&#45;&#45;big">-->
<!--                    <label th:text="#{level.of.education}" class="label input__label"> Level of Education </label>-->
<!--                    <input type="text" class="input personalInfo__input input&#45;&#45;big"  th:value="${ssiInfo != null}? ${ssiInfo[levelOfEducation]}" readonly>-->
<!--                </div>-->
<!--            </div>-->

        </div>


        <div class="row button__row" th:if="${old == null}">
            <div class="inputContainer inputContainer--big" id="InputPrincipal" style="display:none">
                <label th:text="#{principal.afm}" class="label input__label"> Principal AFM </label>
                <input id="InputPrincipalField" type="text" class="input personalInfo__input input--big" onchange="principalAdded()"  >
            </div>

            <div class="inputContainer inputContainer--big" id="AdditionalMemberInput" style=" display:none">
                <label th:text="#{add.member}" class="label input__label"> ADD MEMBER </label>
                <input id="InputMemberField" type="text" class="input personalInfo__input input--big"  >
            </div>
        </div>
        <div class="row button__row" th:if="${old == null}">
            <div id="nextButtonWrapper" class="submitButton isDisabled"  >
                <a id="nextButton" style="pointer-events: none;" th:href="@{'/multi/personalInfo/continue?uuid='+${uuid}}" th:text="#{next}" class="nextLink">Next</a>
            </div>


            <select class="select-css" id="principalSelect" onchange="selectionUpdated()">
                <option value="0">Επιλογή είδους αίτησης:</option>
                <option value="personal">Προσωπική</option>
                <option value="complimentary">Συμπληρωματική</option>
            </select>
        </div>

        <div class="row button__row" th:if="${old}">
            <div class="submitButton "  >
                <a id="nextButton2"   th:href="@{'/multi/personalInfo/continue?uuid='+${uuid}}" th:text="#{next}" class="nextLink">Next</a>
            </div>
        </div>


    <!-- </form> -->
    </div>

    <input type="text"  id="isOld" th:value="${old}" readonly hidden/>

    <div th:replace="fragments/footer"></div>
    <script type="text/javascript" src="../static/js/infoText.js" th:src="@{/js/infoText.js}"></script>
    <script type="text/javascript" src="../static/js/navigation.js" th:src="@{/js/navigation.js}"></script>
    <script type="text/javascript">

         const principalAFMInput = document.getElementById("InputPrincipalField");
         principalAFMInput.oninput = principalAdded;

        function addAfmInputChild(inputField, inputWrapper, additionalAFM,afm){

                inputField.addEventListener('keyup', ({key}) => {
                         if (key === "Enter"){
                             additionalAFM.push(inputField.value);
                             inputField.disabled = true;
                             console.log(additionalAFM);
                             var x = document.createElement("INPUT");
                             x.setAttribute("type", "text");
                             inputWrapper.appendChild(x);
                             addAfmInputChild(x, inputWrapper, additionalAFM,afm)
                              console.log("additionalAFM2")

                        document.getElementById("nextButton").href = document.getElementById("nextButton").href.split("&principal")[0]
                                    +"&principal="+afm +"&household="+additionalAFM.join(',');
                         }
                 })

        }



        function selectionUpdated(){
            const principalSelect = document.getElementById("principalSelect" );
            console.log("selection updated!" +principalSelect.value);
             let additionalMemberInputWrapper = document.getElementById("AdditionalMemberInput");
             let additionalMemberInput = document.getElementById("InputMemberField");

            if(principalSelect.value === "personal"){
             let principalAFMBox = document.getElementById("InputPrincipal");

             additionalMemberInputWrapper.style.display = "flex";

                principalAFMBox.style.display="none";

                //update view by enabling next button
                 let nextBtn = document.getElementById("nextButton");
                 nextBtn.classList.remove("isDisabled");
                 document.getElementById("nextButtonWrapper").classList.remove("isDisabled");

                 nextBtn.style["pointer-events"] = "auto";
                 let afm = document.getElementById("AFM").value;
                 let additionalAFM = [];
                 addAfmInputChild(document.getElementById("InputMemberField"), additionalMemberInputWrapper, additionalAFM,afm);



                    document.getElementById("nextButton").href = document.getElementById("nextButton").href.split("&principal")[0]+"&principal="+afm;



            }
            if(principalSelect.value === "complimentary"){
                console.log("update view to display the principals AFM input field");
                let principalAFMBox = document.getElementById("InputPrincipal");
                principalAFMBox.style.display="block";
                let nextBtn = document.getElementById("nextButton");
                nextBtn.classList.add("isDisabled");
                document.getElementById("nextButtonWrapper").classList.add("isDisabled");
                nextBtn.style["pointer-events"] = "none";
                additionalMemberInputWrapper.style.display = "none";
            }
             if(principalSelect.value === "0"){
                let principalAFMBox = document.getElementById("InputPrincipal");
                principalAFMBox.style.display="none";
                let nextBtn = document.getElementById("nextButton");
                nextBtn.classList.add("isDisabled");
                document.getElementById("nextButtonWrapper").classList.add("isDisabled");
                nextBtn.style["pointer-events"] = "none";
            }
        }

     function principalAdded(e){
        console.log("principal afm" + e.target.value);
         let nextBtn = document.getElementById("nextButton");
         nextBtn.classList.remove("isDisabled");
         document.getElementById("nextButtonWrapper").classList.remove("isDisabled");
         nextBtn.style["pointer-events"] = "auto";
         document.getElementById("nextButton").href = document.getElementById("nextButton").href.split("&principal")[0]+"&principal="+e.target.value;
     }


        const genderBoxes = document.getElementsByClassName("gender__checkBox");
        const genderBoxContainers = document.getElementsByClassName("gender__checkboxContainer");
        const genderMain = document.getElementById("genderMain");
        const principalSelect = document.getElementById("principalSelect");



        for(let i=0; i< genderBoxes.length; i++){
            genderBoxes[i].addEventListener('click', function(){
                if(this.checked == true){
                    genderBoxContainers[i].style.backgroundColor = "lightgrey";
                    genderMain.value = genderBoxes[i].id;
                    for(let j=0; j< genderBoxes.length; j++){
                        if(j != i){
                            genderBoxes[j].checked = false;
                            genderBoxContainers[j].style.backgroundColor = "rgb(226, 226, 226)";
                        }
                    }
                    
                } else {
                    genderBoxContainers[i].style.backgroundColor = "rgb(226, 226, 226)";
                    genderMain.value = '';
                }
            });
        }

        for(let i=0; i< genderBoxes.length; i++){
            if(genderBoxes[i].id == genderMain.value){
                genderBoxes[i].checked = true;
                genderBoxContainers[i].style.backgroundColor = "lightgrey";
            }
        }
    </script>
</body>
</html>